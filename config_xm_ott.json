[{"url":"^([^\\\/]*?\\:\\\/\\\/)(m\\.tv\\.sohu\\.com\\\/.*|v\\.youku\\.com\\\/v_show\\\/id_.*|www\\.tudou\\.com\\\/.+|m\\.iqiyi\\.com\\\/.+|m\\.56\\.com\\\/.+|m\\.letv\\.com\\\/vplay.+|m\\.ku6\\.com\\\/show\\\/.+|v\\.ifeng\\.com\\\/.+|m\\.pptv\\.com\\\/show\\\/.+|m\\.pps\\.tv\\\/play.+|[^\\\/]+\\\/app\\\/yinyuetai\\\/movie.+|[^\\\/]+\\\/app\\\/soku.+)$","tpl":";\r\nwindow.PLAY_URL = (window.netip && window.netip!='')? 'http:\/\/'+window.netip+':8080\/app\/reveal\/?u=' : 'http:\/\/api-dev.vsea.tv\/app\/reveal\/?u=';\r\nwindow.MERGE_URL = (window.netip && window.netip!='')? 'http:\/\/'+window.netip+':8080\/app\/reveal\/?u=' : 'http:\/\/172.25.3.116:8080\/app\/reveal\/?u=';\r\nwindow.OTT_API = '';\r\nwindow.SHOW_TAB = 'no';\r\n\r\n;(function(){\r\n\tif (window.sendOTTData)\r\n\t\treturn;\r\n\twindow.OTT_JSON_DATA = '';\r\n\twindow.sendOTTData = {};\r\n\twindow.sendOTTData.send = function (s) {\r\n\t\twindow.OTT_JSON_DATA = s;\r\n\t\tvar f = document.createElement('iframe');\r\n\t\tf.style.display = 'none';\r\n\t\tdocument.documentElement.appendChild(f);\r\n\t\tf.src = \"cmd:\/\/SEND_OTT_DATA\";\r\n\t};\r\n\r\n})();\r\n\r\n(function(){\r\n\tconsole.log('init check')\r\n\tvar url = (window.__src_url) ? window.__src_url : window.location.href;\r\n\tvar body = (window.__src_code) ? window.__src_code : document.documentElement.outerHTML;\r\n\tvar m = null, m2 = null;\r\n\tvar src = null;\r\n\r\n\tvar img, title;\r\n\r\n\tvar data = {\r\n\t\timg: null,\r\n\t\ttitle: null,\r\n\t\tcache: url,\r\n\t\tm_url: null\r\n\t};\r\n\t\/\/ &seek=OTT\r\n\tvar ext = '&playmode=play';\r\n\r\n\r\n\tvar getRevealUrl = function (u) {\r\n\t\treturn [PLAY_URL+encodeURIComponent(u)+ext, MERGE_URL+encodeURIComponent(u)+ext+'&mode=getMergeUrl&seek=OTT'];\r\n\t};\r\n\r\n\tvar returnPageDataDone = false;\r\n\tvar returnPageData = function (force) {\r\n\t\tif (returnPageDataDone)\r\n\t\t\treturn;\r\n\t\tif ( force || (data && data.img && data.m_url) ) {\r\n\t\t\treturnPageDataDone = true;\r\n\t\t\tif ( !(data && data.m_url) ) {\r\n\t\t\t\tconsole.log('get page data null');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar s = JSON.stringify(data);\r\n\t\t\tconsole.log('get page data: '+s);\r\n\t\t\tif (window.sendOTTData) {\r\n\t\t\t\tconsole.log('call sendOTTData.send');\r\n\t\t\t\twindow.sendOTTData.send(s);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('no sendOTTData method.');\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar simpleAjax = function (url, sf, ef, df) {\r\n\t\tvar xhr;\r\n\t\tif (window.XMLHttpRequest){\r\n\t\t\txhr=new XMLHttpRequest();\r\n\t\t} else {\r\n\t\t\txhr=new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t}\r\n\t\txhr.onreadystatechange = function(){\r\n\t\t\tif(xhr.readyState === 4){\r\n\t\t\t\tif(xhr.status === 200){\r\n\t\t\t\t\tif (sf) {\r\n\t\t\t\t\t\tsf(xhr.responseText);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (ef) {\r\n\t\t\t\t\t\tef(xhr.status);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (df) {\r\n\t\t\t\t\tdf(xhr.status);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\txhr.open(\"GET\",url,true);\r\n\t\txhr.send();\r\n\t};\r\n\r\n\tvar insertScript = function (url) {\r\n\t\tvar e=document.createElement('script'); \r\n\t\te.setAttribute('src', url); \r\n\t\tdocument.head.appendChild(e);\r\n\t};\r\n\r\n\tvar JSONparse = function (s) {\r\n\t\tvar d;\r\n\t\ttry {\r\n\t\t\td=JSON.parse(s);\r\n\t\t} catch(e) {\r\n\r\n\t\t}\r\n\t\treturn d;\r\n\t};\r\n\r\n\tfunction rnd(start, end){\r\n\t    return Math.floor(Math.random() * (end - start) + start);\r\n\t}\r\n\r\n\r\n\tvar parseComplete = 0;\r\n\tvar parseDone = function () {\r\n\t\tparseComplete--;\r\n\t\tif (parseComplete<1) {\r\n\t\t\treturnPageData();\r\n\t\t}\r\n\t};\r\n\r\n\r\n\t\/\/ http:\/\/v.youku.com\/v_show\/id_XNTkyNjY1NjQ0.html?f=19532522&ev=1\r\n\tif ( null != (m=url.match(\/^http\\:\\\/\\\/v\\.youku\\.com\\\/v_show\\\/id_([^\\&\\#\\\/\\.]*).*$\/i)) ) {\r\n\t\t\/\/ youku\r\n\t\tvar vid=m[1];\r\n\t\tsrc=getRevealUrl(\"http:\/\/v.youku.com\/v_show\/id_\"+vid+\".html\");\r\n\r\n\t\tvar __youku_complete = 0;\r\n\t\twindow.__check_getYoukuData = function (d) {\r\n\t\t\tif (d && d.data && d.data[0]) {\r\n\t\t\t\tdata.img = d.data[0].logo;\r\n\t\t\t\tdata.title = d.data[0].title;\r\n\t\t\t}\r\n\t\t\tparseDone();\r\n\t\t};\r\n\r\n\t\twindow.__youkuAd = function (d) {\r\n\t\t\tif (d && d.VAL && d.VAL[0]) {\r\n\t\t\t\tvar ad_url = getRevealUrl(d.VAL[0].RS);\r\n\t\t\t\tdata.ad_url = ad_url[1]+'&site=vod';\r\n\t\t\t}\r\n\t\t\tparseDone();\r\n\t\t};\r\n\r\n\t\tparseComplete++;\r\n\t\tinsertScript('http:\/\/v.youku.com\/player\/getPlaylist\/VideoIDS\/'+vid+'\/Pf\/4?__callback=__check_getYoukuData');\r\n\r\n\t\tif (window.adsParams) {\r\n\t\t\tparseComplete++;\r\n\t\t\tinsertScript('http:\/\/valf.atm.youku.com\/vf?vl=256'+window.adsParams+'&callback=__youkuAd');\r\n\t\t} else if (window.videoId) {\r\n\t\t\tparseComplete++;\r\n\t\t\tinsertScript('http:\/\/valf.atm.youku.com\/vf?vl=256&ct=a&cs=2148&td=0'+'&s='+window.showId+'&v='+window.videoId+'&u='+window.videoOwnerID+'&callback=__youkuAd');\r\n\t\t}\r\n\r\n\t\tsetTimeout(parseDone, 2000);\r\n\r\n\t} else if ( null != (m=url.match(\/tv.sohu.com\/i)) && null != (m=body.match(\/\\s+vid\\s*[\\:\\=]\\s*\\\"(\\d+)\\\"\/i)) && null != (m2=body.match(\/og\\:url.*?content\\=\\\"(.+?)\\\"\/i)) ) {\r\n\t\t\/\/ sohu\r\n\t\text += '&iid='+m[1];\r\n\t\tsrc=getRevealUrl(m2[1]);\r\n\t\tif ( null != (img=body.match(\/apple-touch-icon-precomposed.*?href=\\\"(.*?)\\\"\/i)) && null != (title=body.match(\/keywords.*?content=\\\"(.*?)\\\"\/i)) ) {\r\n\t\t\tdata.img = img[1];\r\n\t\t\tdata.title = title[1];\r\n\t\t}\r\n\r\n\t\twindow.__sohuAd = function (d) {\r\n\t\t\tconsole.log('call __sohuAd', d);\r\n\t\t\tif (d && d.data && d.oad != '') {\r\n\t\t\t\td.data.oad = d.data.oad.replace(\/\\'\/g,'\"');\r\n\t\t\t\tvar dd = JSONparse(d.data.oad);\r\n\t\t\t\tconsole.log('get ad data', dd);\r\n\t\t\t\tif (dd && dd[0] && dd[0][0]) {\r\n\t\t\t\t\tvar ad_url = getRevealUrl(dd[0][0]);\r\n\t\t\t\t\tdata.ad_url = ad_url[1]+'&site=vod';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparseDone();\r\n\t\t};\r\n\r\n\t\tif (window.VideoData && window.VideoData.vid && window.VideoData.tvid && window.VideoData.sid) {\r\n\t\t\tparseComplete++;\r\n\t\t\tinsertScript('http:\/\/v.aty.sohu.com\/v?type=vrs&al='+VideoData.sid+'&vid='+VideoData.vid+'&tvid='+VideoData.tvid+'&c=tv&fee=0&isIf=0&du='+VideoData.duration+'&out=0&uid=&qd=&autoPlay=1&callback=__sohuAd&pageUrl='+url);\r\n\t\t}\r\n\t\t\r\n\t\tsetTimeout(parseDone, 2000);\r\n\t} else if ( null != (m=url.match(\/.*tudou.com.*\/i)) && window.itemData ) {\r\n\t\tvar _d = window.itemData;\r\n\t\tif (_d.vcode && _d.vcode!='') {\r\n\t\t\text += '&vcode='+_d.vcode;\r\n\t\t} else {\r\n\t\t\t\/\/ext += '&iid='+_d.iid;\r\n\t\t}\r\n\t\tsrc = getRevealUrl(url);\r\n\t\tdata.img = _d.pic;\r\n\t\tdata.title = _d.kw;\r\n\r\n\t\tvar lastVid = false;\r\n\t\tvar checkChange = function () {\r\n\t\t\tif (window.itemData) {\r\n\t\t\t\tvar v = window.itemData;\r\n\t\t\t\tif (!lastVid) {\r\n\t\t\t\t\tlastVid = v.iid;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (v.iid != lastVid) {\r\n\t\t\t\t\tconsole.log('tudou get new location');\r\n\t\t\t\t\tclearInterval(checkChangeI);\r\n\t\t\t\t\tif (v.acode && v.acode != '')\r\n\t\t\t\t\t\twindow.location.href='http:\/\/www.tudou.com\/albumplay\/'+v.acode+'\/'+v.icode+'.html';\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\twindow.location.href='http:\/\/www.tudou.com\/programs\/view\/'+v.icode+'\/';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar checkChangeI=setInterval(checkChange, 50);\r\n\r\n\t\twindow.__youkuAd = function (d) {\r\n\t\t\tif (d && d.VAL && d.VAL[0]) {\r\n\t\t\t\tvar ad_url = getRevealUrl(d.VAL[0].RS);\r\n\t\t\t\tdata.ad_url = ad_url[1]+'&site=vod';\r\n\t\t\t}\r\n\t\t\tparseDone();\r\n\t\t};\r\n\r\n\t\t\/\/ check ad\r\n\t\tif (window.itemData && window.itemData.iid && window.itemData.oid && window.aid) {\r\n\t\t\tparseComplete++;\r\n\t\t\tinsertScript('http:\/\/valf.atm.youku.com\/vf?vl=256&ct=a&cs=2148&td=0'+'&s='+aid+'&v='+itemData.iid+'&u='+itemData.oid+'&callback=__youkuAd');\r\n\t\t}\r\n\t\t\r\n\t\tsetTimeout(parseDone, 2000);\r\n\t\t\r\n\t} else if ( null != (m=url.match(\/.*letv.com.*\/i)) && (\r\n\t\tnull != (m=url.match(\/m\\.letv\\.com\\\/vplay\\_(.*?)\\.html.*\/i)) ||\r\n\t\tnull != (m=url.match(\/www\\.letv\\.com\\\/ptv\\\/vplay\\\/(.*?)\\.html.*\/i))\r\n\t\t) ) {\r\n\t\tvar leurl = 'http:\/\/www.letv.com\/ptv\/vplay\/'+m[1]+'.html';\r\n\t\tsrc = getRevealUrl(leurl);\r\n\t\tif ( null != (img=body.match(\/apple-touch-icon-precomposed.*?href=\\\"(.*?)\\\"\/i)) && null != (title=body.match(\/title\\s*:\\s*[\\\"\\'](.*?)[\\\"\\']\/i)) ) {\r\n\t\t\tdata.img = img[1];\r\n\t\t\tdata.title = title[1];\r\n\t\t}\r\n\r\n\t} else if ( null != (m=url.match(\/.*sina.cn.*\/i)) && null != (m=body.match(\/location\\.php\\?.*?url\\=([^\\&\\#\\'\\\"]+)\/i)) ) {\r\n\t\tvar u = decodeURIComponent(m[1]);\r\n\t\tsrc = getRevealUrl(u);\r\n\t\tif ( null != (img=body.match(\/poster=\\\"(.*?)\\\"\/i)) && null != (title=body.match(\/<h2>(.*?)<\\\/h2>\/i)) ) {\r\n\t\t\tdata.img = img[1];\r\n\t\t\tdata.title = title[1];\r\n\t\t}\r\n\t} else if ( null != (m=url.match(\/.*56.com.*\/i)) && null != (m=body.match(\/src\\=\\\"http\\:\\\/\\\/vxml.56.com\\\/html5\\\/(\\d+)\\\/\/i)) ) {\r\n\t\text += '&iid='+m[1];\r\n\t\tsrc = getRevealUrl(url);\r\n\t\tif ( null != (img=body.match(\/url\\((.*?)\\)\/i)) && null != (title=body.match(\/keywords.*?content=\\\"(.*?)\\\"\/i)) ) {\r\n\t\t\tdata.img = img[1];\r\n\t\t\tdata.title = title[1];\r\n\t\t}\r\n\t} else if ( null != (m=url.match(\/.*m\\.iqiyi\\.com\\\/play.html.*?tvid\\=([^\\&\\#]+).*?vid\\=([^\\&\\#]+)\/i)) ) {\r\n\t\t\r\n\t\text += '&iid='+m[1]+'_'+m[2];\r\n\t\tvar lastVid = m[2];\r\n\t\tif (window.tvInfoJs) {\r\n\t\t\tdata.img = window.tvInfoJs.vpic;\r\n\t\t\tdata.title = window.tvInfoJs.vn;\r\n\t\t\tsrc = getRevealUrl(window.tvInfoJs.vu);\r\n\t\t} else {\r\n\t\t\tsrc = getRevealUrl(url);\r\n\t\t}\r\n\r\n\t\tvar checkChange = function () {\r\n\t\t\tif (window.tvInfoJs) {\r\n\t\t\t\tif (!returnPageDataDone) {\r\n\t\t\t\t\tdata.img = window.tvInfoJs.vpic;\r\n\t\t\t\t\tdata.title = window.tvInfoJs.vn;\r\n\t\t\t\t\treturnPageData();\r\n\t\t\t\t}\r\n\t\t\t\tvar v = window.tvInfoJs;\r\n\t\t\t\tif (!lastVid) {\r\n\t\t\t\t\tlastVid = v.vid;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (v.vid != lastVid) {\r\n\t\t\t\t\tconsole.log('iqiyi get new location')\r\n\t\t\t\t\tclearInterval(checkChangeI);\r\n\t\t\t\t\twindow.location.href='http:\/\/m.iqiyi.com\/play.html?tvid='+v.tvid+'&vid='+v.vid;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar checkChangeI=setInterval(checkChange, 50);\r\n\r\n\r\n\t\tvar fixClickTime = 1000;\r\n\t\tvar fixClick = function () {\r\n\t\t\tvar _a = document.getElementsByTagName('a');\r\n\t\t\tfor (var i = 0; i < _a.length; i++) {\r\n\t\t\t\tif (_a[i].getAttribute('data-delegate') == 'play') {\r\n\t\t\t\t\t_a[i].setAttribute('data-delegate', 'go');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tsetTimeout(arguments.callee, fixClickTime);\r\n\t\t};\r\n\t\t\r\n\t\tfixClick();\r\n\r\n\t} else if ( null != (m=url.match(\/.*m.(ku6.com.*)\/i)) ) {\r\n\t\tsrc = getRevealUrl('http:\/\/v.'+m[1]);\r\n\t\tif ( null != (img=body.match(\/vid,\\s*\\'(.*?)\\'\/i)) && null != (title=body.match(\/<title>(.*?)<\\\/title>\/i)) ) {\r\n\t\t\tdata.img = img[1];\r\n\t\t\tdata.title = title[1];\r\n\t\t}\r\n\t} else if ( null != (m=url.match(\/.*v\\.ifeng\\.com.*\/i)) && (null != (m=url.match(\/([\\w\\d]+\\-[\\w\\d]+\\-[\\w\\d]+\\-[\\w\\d]+\\-[\\w\\d]+)\/i)) || null != (m=body.match(\/([\\w\\d]+\\-[\\w\\d]+\\-[\\w\\d]+\\-[\\w\\d]+\\-[\\w\\d]+)\/i)) ) ) {\r\n\t\text += '&iid='+m[1];\r\n\t\tsrc = getRevealUrl(url);\r\n\t\tif ( null != (img=body.match(\/image\\\"\\s*content\\=\\\"(.*?)\\\"\/i)) && null != (title=body.match(\/title\\\"\\s*content\\=\\\"(.*?)\\\"\/i)) ) {\r\n\t\t\tdata.img = img[1];\r\n\t\t\tdata.title = title[1];\r\n\t\t}\r\n\r\n\t\t(function(){\r\n\t\t\tvar checkUrl = function () {\r\n\t\t\t\tif (window.location.href != url) {\r\n\t\t\t\t\twindow.location.href = window.location.href.replace(\/\\#\/i, '?#');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetTimeout(checkUrl, 500);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tsetTimeout(checkUrl, 500);\r\n\t\t})();\r\n\t} else if ( null != (m=url.match(\/.*[mv].(pptv.com.*)\/i)) && window.m_info && window.webcfg ) {\r\n\t\text += '&iid=' + webcfg.channel_id;\r\n\t\tsrc = getRevealUrl('http:\/\/v.'+m[1]);\r\n\t\t\r\n\t\tdata.img = 'http:\/\/s'+rnd(1, 4)+'.pplive.cn\/v\/cap\/'+webcfg.channel_id+'\/h160.jpg';\r\n\t\tdata.title = m_info.title;\r\n\t} else if ( null != (m=url.match(\/.*[mv].(pps.tv\\\/play.*)\/i)) && window.page_var ) {\r\n\t\text += '&iid=' + page_var.url_key;\r\n\t\tsrc = getRevealUrl('http:\/\/v.'+m[1]);\r\n\t\t\r\n\t\tdata.img = page_var.video_img;\r\n\t\tdata.title = page_var.file_title;\r\n\t} else if ( null != (m=url.match(\/.*?app\\\/yinyuetai\\\/movie.*\/i)) && window.__PAGE_DATA ) {\r\n\t\text += '&iid=' + __PAGE_DATA.iid;\r\n\t\tsrc = getRevealUrl(__PAGE_DATA.url);\r\n\t\tdata.title = __PAGE_DATA.title;\r\n\t\tdata.img = __PAGE_DATA.img;\r\n\t}\r\n\r\n\r\n\t\/\/ check hidePlay button\r\n\tif  (window.hidePlayButton && window.SHOW_TAB=='no') {\r\n\t\twindow.hidePlayButton();\r\n\t}\r\n\r\n\tif ( null != src && '' != src ) {\r\n\t\tvar appendBtn = function () {\r\n\t\t\tdata.m_url = src[0]+'&quality=0';\r\n\r\n\t\t\tvar mu = [src[1]+'&quality=0', src[1]+'&quality=1', src[1]+'&quality=2'];\r\n\t\t\tdata.ottsd_url= mu[1];\r\n\t\t\tdata.otthd_url= mu[2];\r\n\t\t\treturnPageData();\r\n\t\t};\r\n\r\n\t\tappendBtn();\r\n\t} else {\r\n\t\tdata = null;\r\n\t\treturnPageData(true);\r\n\t}\r\n\r\n\r\n\treturnPageData();\r\n})();\r\n","type":"1"}]